<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coloriage magique ‚Äî Arbre des relatifs</title>
<link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f8fbff;
  --shadow:0 6px 18px rgba(25,42,70,0.08);
}
body{
  margin:0;
  font-family:'Androgy Demo',sans-serif;
  background:var(--bg);
  color:#0f172a;
}
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:1rem;
}
h1{
  color:#3a86ff;
  font-size:2rem;
  margin:0;
}
.controls select, .controls button{
  padding:0.5rem;
  border-radius:8px;
  border:1px solid #ddd;
  font-family:inherit;
}
button{
  background:#3a86ff;
  color:#fff;
  border:none;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.palette{
  display:flex;
  gap:0.5rem;
  margin:1rem;
  flex-wrap:wrap;
  justify-content:center;
}
.color-btn{
  width:40px;
  height:40px;
  border-radius:6px;
  border:2px solid #000;
  cursor:pointer;
}
main{
  padding:1rem;
  display:flex;
  justify-content:center;
}
.workspace{
  background:#fff;
  border-radius:12px;
  box-shadow:var(--shadow);
  padding:1rem;
}
svg{
  width:100%;
  max-width:800px;
  height:auto;
  border-radius:12px;
  background:linear-gradient(#b3e5fc,#fdfdfd);
}
footer{
  text-align:center;
  color:#6b7280;
  padding:1rem;
}
.legend{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:1rem;
  margin-top:1rem;
}
.legend-item{
  display:flex;
  align-items:center;
  gap:0.4rem;
}
.legend-color{
  width:20px;height:20px;border-radius:4px;border:1px solid #000;
}
</style>
</head>
<body>
<header>
  <h1>Coloriage magique ‚Äî Arbre des relatifs</h1>
  <div class="controls">
    <button id="generate">Nouvelle feuille</button>
  </div>
</header>

<div class="palette" id="palette"></div>

<main>
  <div class="workspace" id="workspace"></div>
</main>

<footer>
  Clique sur une couleur puis sur la case du bon r√©sultat pour la colorier üåà
</footer>

<script>
const ws=document.getElementById('workspace');
const genBtn=document.getElementById('generate');
const palette=document.getElementById('palette');
let currentColor=null;

// Association r√©sultat ‚Üí couleur
const colorMap = {
  "-3": "#8B4513", // tronc fonc√©
  "-2": "#A0522D", // racines
  "-1": "#006400", // feuilles fonc√©es
   "0": "#228B22", // feuilles
   "1": "#ADFF2F", // feuillage clair
   "2": "#87CEEB", // ciel
   "3": "#F4A460"  // sol ou lumi√®re
};

// Palette dynamique
function buildPalette(){
  palette.innerHTML="";
  Object.entries(colorMap).forEach(([val,color])=>{
    const btn=document.createElement("div");
    btn.className="color-btn";
    btn.dataset.value=val;
    btn.dataset.color=color;
    btn.style.background=color;
    btn.title=`R√©sultat = ${val}`;
    btn.addEventListener("click",()=>currentColor=color);
    palette.appendChild(btn);
  });
}

// G√©n√®re une expression al√©atoire (r√©sultats born√©s)
function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function randomExpr(){
  const ops=['+','-'];
  let a=randInt(-5,5), b=randInt(-5,5);
  const op=ops[randInt(0,ops.length-1)];
  let expr=`${a} ${op} ${b}`;
  let val=Math.round(eval(expr));
  val=Math.max(-3,Math.min(3,val)); // borne entre -3 et 3
  return {expr:expr.replace('*','√ó').replace('/','√∑'),val};
}

// Cr√©e la grille
function genColoriage(){
  ws.innerHTML="";
  const cols=6, rows=8;
  const cellW=100, cellH=70;
  const width=cols*cellW+40, height=rows*cellH+80;
  const svgns='http://www.w3.org/2000/svg';
  const svg=document.createElementNS(svgns,'svg');
  svg.setAttribute('viewBox',`0 0 ${width} ${height}`);

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const x=20+c*cellW, y=40+r*cellH;
      const {expr,val}=randomExpr();
      const rect=document.createElementNS(svgns,'rect');
      rect.setAttribute('x',x);
      rect.setAttribute('y',y);
      rect.setAttribute('width',cellW-6);
      rect.setAttribute('height',cellH-6);
      rect.setAttribute('rx',8);
      rect.setAttribute('fill','#fff');
      rect.setAttribute('stroke','#000');
      rect.style.cursor='pointer';
      rect.dataset.value=val;
      svg.appendChild(rect);

      const text=document.createElementNS(svgns,'text');
      text.setAttribute('x',x+cellW/2-4);
      text.setAttribute('y',y+cellH/2+4);
      text.setAttribute('text-anchor','middle');
      text.setAttribute('font-size','14');
      text.textContent=expr;
      svg.appendChild(text);

      rect.addEventListener('click',()=>{
        if(currentColor){
          const correctColor=colorMap[rect.dataset.value];
          if(currentColor===correctColor){
            rect.setAttribute('fill',currentColor);
          } else {
            rect.setAttribute('fill','#ffcccc'); // erreur en rouge clair
            setTimeout(()=>rect.setAttribute('fill','#fff'),500);
          }
        }
      });
    }
  }
  ws.appendChild(svg);

  // L√©gende
  const legend=document.createElement('div');
  legend.className='legend';
  legend.innerHTML=Object.entries(colorMap).map(([v,c])=>
    `<div class="legend-item"><div class="legend-color" style="background:${c}"></div>= ${v}</div>`
  ).join("");
  ws.appendChild(legend);
}

buildPalette();
genBtn.onclick=genColoriage;
window.onload=genColoriage;
</script>
</body>
</html>
