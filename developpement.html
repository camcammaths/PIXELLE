<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Développe - Maths ludiques</title>

<!-- Polices -->
<link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />

<style>
  :root {
    --primary: #3a86ff;
    --secondary: #8338ec;
    --background: #f0f4f8;
    --text: #212529;
    --btn-bg: #a8d0ff;
    --btn-hover: #7ab3ff;
    --border-radius: 8px;
    --transition: 0.3s ease;
    --correct: #4CAF50;
    --incorrect: #e74c3c;
  }

  body {
    font-family: 'Mabry Pro', sans-serif;
    background: var(--background);
    color: var(--text);
    margin: 2rem;
    user-select: none;
  }

  h1 {
    font-family: 'Androgy Demo', sans-serif;
    text-transform: capitalize;
    color: var(--primary);
    text-align: center;
    margin-bottom: 1.5rem;
  }

  a.back {
    display: inline-block;
    margin-bottom: 1.5rem;
    font-weight: 600;
    color: var(--primary);
    text-decoration: none;
    font-family: 'Mabry Pro', sans-serif;
    border: 2px solid var(--primary);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    transition: background-color var(--transition), color var(--transition);
  }
  a.back:hover {
    background-color: var(--primary);
    color: white;
  }

  #expression {
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1.5rem;
  }

  #game {
    max-width: 900px;
    margin: 0 auto;
    display: flex;
    gap: 3rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  .column {
    flex: 1;
    min-width: 280px;
  }

  .column h2 {
    font-family: 'Androgy Demo', sans-serif;
    color: var(--secondary);
    text-align: center;
    margin-bottom: 1rem;
  }

  .dropzone {
    background: white;
    min-height: 60px;
    margin-bottom: 1rem;
    border: 2px dashed var(--primary);
    border-radius: var(--border-radius);
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: default;
    font-weight: bold;
    transition: background-color var(--transition), border-color var(--transition);
  }

  .dropzone.filled { 
    border-style: solid;
    background-color: #d0e2ff;
  }

  .card {
    background: var(--primary);
    color: white;
    padding: 1rem 1.25rem;
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
    cursor: grab;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    user-select: none;
    transition: opacity 0.3s, transform 0.3s;
  }

  .card.dragging {
    opacity: 0.5;
    cursor: grabbing;
    transform: scale(0.98);
  }

  #check-btn, #next-btn {
    margin: 1.5rem auto;
    display: block;
    padding: 0.75rem 2rem;
    font-weight: 600;
    font-size: 1.1rem;
    background-color: var(--secondary);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(131, 56, 236, 0.6);
    transition: background-color var(--transition);
    user-select: none;
  }

  #check-btn:hover, #next-btn:hover {
    background-color: #6829b0;
  }

  #result {
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
    min-height: 1.5em;
  }

</style>
</head>
<body>

<h1>Développe</h1>
<a href="index.html" class="back">← Retour à la page principale</a>

<div id="expression">a(x + b)</div>

<div id="game">
  <div class="column" id="slots-col">
    <h2>Résultat</h2>
  </div>
  <div class="column" id="palette-col">
    <h2>Termes</h2>
  </div>
</div>

<button id="check-btn">Vérifier</button>
<button id="next-btn">Nouvelle expression</button>
<div id="result"></div>

<script>
  const expressionEl = document.getElementById('expression');
  const slotsCol = document.getElementById('slots-col');
  const paletteCol = document.getElementById('palette-col');
  const resultEl = document.getElementById('result');

  let currentTerms = [];
  let dragged = null;

  function generateQuestion() {
    const a = Math.floor(Math.random()*5)+2;
    const b = Math.floor(Math.random()*5)+1;
    const sign = Math.random()<0.5?'+':'-';
    const expr = `${a}(x ${sign} ${b})`;
    const constTerm = sign==='+' ? a*b : -a*b;
    const terms = [`${a}x`, `${constTerm}`];
    return {expr, terms};
  }

  function renderQuestion() {
    const q = generateQuestion();
    currentTerms = q.terms;
    expressionEl.textContent = q.expr;

    slotsCol.innerHTML = '<h2>Résultat</h2>';
    paletteCol.innerHTML = '<h2>Termes</h2>';

    q.terms.forEach(term => {
      const slot = document.createElement('div');
      slot.className = 'dropzone';
      slot.dataset.expect = term;
      slotsCol.appendChild(slot);
    });

    const bricks = [...q.terms, `${Math.floor(Math.random()*10)+1}`].sort(()=>Math.random()-0.5);
    bricks.forEach(t => {
      const card = document.createElement('div');
      card.className = 'card';
      card.textContent = t;
      card.draggable = true;
      card.addEventListener('dragstart', () => { dragged = card; card.classList.add('dragging'); });
      card.addEventListener('dragend', () => { dragged = null; card.classList.remove('dragging'); });
      paletteCol.appendChild(card);
    });

    resultEl.textContent = '';
  }

  function addDropLogic() {
    const dropzones = document.querySelectorAll('.dropzone');
    dropzones.forEach(zone => {
      zone.addEventListener('dragover', e => e.preventDefault());
      zone.addEventListener('drop', e => {
        e.preventDefault();
        if(!dragged) return;

        const existing = zone.querySelector('.card');
        if(existing) paletteCol.appendChild(existing);

        zone.appendChild(dragged);
        zone.classList.add('filled');
      });
    });
  }

  document.getElementById('check-btn').addEventListener('click', () => {
    let correct = true;
    document.querySelectorAll('.dropzone').forEach(zone => {
      const actual = zone.querySelector('.card')?.textContent || '';
      if(actual === zone.dataset.expect){
        zone.style.borderColor = 'green';
        zone.style.backgroundColor = '#d4f8d4';
      } else {
        zone.style.borderColor = 'red';
        zone.style.backgroundColor = '#f8d4d4';
        correct = false;
      }
    });
    resultEl.style.color = correct ? 'green' : 'red';
    resultEl.textContent = correct ? 'Bravo ✅' : 'Des erreurs ❌';
  });

  document.getElementById('next-btn').addEventListener('click', () => {
    renderQuestion();
    addDropLogic();
  });

  renderQuestion();
  addDropLogic();
</script>

</body>
</html>

