<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Théorème de Pythagore</title>

<!-- Polices -->
<link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />

<style>
:root {
  --primary-color: #3a86ff;
  --secondary-color: #8338ec;
  --background-color: #f0f4f8;
  --text-color: #212529;
  --border-radius: 14px;
  --transition: 0.3s ease;
  --shadow: 0 6px 14px rgba(0, 0, 0, 0.1);
}

body {
  font-family: 'Mabry Pro', sans-serif;
  background: var(--background-color);
  color: var(--text-color);
  margin: 2rem;
  text-align: center;
}

h1 {
  font-family: 'Androgy Demo', sans-serif;
  font-size: 2.5rem;
  color: var(--primary-color);
  margin-bottom: 2rem;
}

.container {
  display: flex;
  justify-content: center;
  align-items: stretch;
  gap: 2rem;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.card {
  background: white;
  border-radius: var(--border-radius);
  padding: 1.5rem;
  box-shadow: var(--shadow);
  flex: 1 1 340px;
  min-width: 320px;
  max-width: 380px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

figure {
  margin: 0;
}

svg {
  display: block;
  margin: 0 auto;
}

figcaption {
  margin-top: 0.8rem;
  font-weight: bold;
  color: var(--secondary-color);
}

#text-area {
  text-align: left;
  line-height: 1.6;
}

span.editable {
  border-bottom: 2px dotted var(--primary-color);
  cursor: text;
  display: inline-block;
  min-width: 30px;
  padding: 0 2px;
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1rem;
}

button {
  padding: 0.8rem 1.6rem;
  background-color: var(--primary-color);
  border: none;
  color: white;
  font-weight: bold;
  font-size: 1rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: background-color var(--transition), transform var(--transition);
  min-width: 160px;
}
button:hover {
  background-color: #2a68cc;
  transform: translateY(-2px);
}

#feedback {
  font-weight: bold;
  margin-top: 1.2rem;
  font-size: 1.1rem;
}
</style>
</head>

<body>
<h1>Théorème de Pythagore</h1>

<div class="container">
  <!-- Bloc Figure -->
  <div class="card">
    <figure>
      <svg width="220" height="180">
        <polygon id="triangle" points="40,140 160,140 40,40" fill="none" stroke="#3a86ff" stroke-width="3"/>
        <text x="30" y="40" font-size="16" fill="#212529">A</text>
        <text x="165" y="145" font-size="16" fill="#212529">C</text>
        <text x="25" y="150" font-size="16" fill="#212529">B</text>
        <text id="AB" x="10" y="90" font-size="14" fill="#212529"></text>
        <text id="BC" x="90" y="155" font-size="14" fill="#212529"></text>
        <text id="AC" x="110" y="80" font-size="14" fill="#212529"></text>
      </svg>
      <figcaption>Triangle ABC</figcaption>
    </figure>
  </div>

  <!-- Bloc Texte -->
  <div class="card">
    <div id="text-area"></div>
  </div>
</div>

<div id="feedback"></div>

<div class="buttons">
  <button onclick="checkAnswers()">Vérifier</button>
  <button onclick="generateExercise()">Nouvel exercice</button>
</div>

<script>
const textArea = document.getElementById('text-area');
const feedback = document.getElementById('feedback');
const sideAB = document.getElementById('AB');
const sideBC = document.getElementById('BC');
const sideAC = document.getElementById('AC');

let correctValues = {};

function generateExercise() {
  const AB = (Math.random() * 2 + 1).toFixed(1);
  const BC = (Math.random() * 3 + 2).toFixed(1);
  const AC = Math.sqrt(AB**2 + BC**2).toFixed(1);

  const AB2 = (AB ** 2).toFixed(2);
  const BC2 = (BC ** 2).toFixed(2);
  const AC2 = (AC ** 2).toFixed(2);
  const sum = (parseFloat(AB2) + parseFloat(BC2)).toFixed(2);

  correctValues = {
    AB, BC, AC, AB2, BC2, AC2, sum,
    angle: "B",
    formula: "AC² = AB² + BC²"
  };

  const wrongAngle = ["A", "B", "C"].sort(() => Math.random()-0.5)[0];
  const wrongFormulaOptions = [
    "AB² = AC² + BC²",
    "AC² = AB² - BC²",
    "BC² = AB² + AC²"
  ];
  const wrongFormula = wrongFormulaOptions[Math.floor(Math.random() * wrongFormulaOptions.length)];

  const angleError = Math.random() < 0.5;
  const formulaError = Math.random() < 0.5;

  const angleText = angleError ? wrongAngle : "B";
  const formulaText = formulaError ? wrongFormula : "AC² = AB² + BC²";

  const randomErr = (val) => (Math.random() < 0.4 ? (parseFloat(val)+(Math.random()*1-0.5)).toFixed(2) : val);

  const texte = `
  Le triangle ABC est rectangle en <span class="editable" contenteditable>${angleText}</span>.<br>
  D’après le théorème de Pythagore,<br>
  on a :<br>
  <span class="editable" contenteditable>${formulaText}</span><br><br>
  AC² = <span class="editable" contenteditable>${randomErr(AB)}²</span> + <span class="editable" contenteditable>${randomErr(BC)}²</span><br>
  AC² = <span class="editable" contenteditable>${randomErr(AB2)}</span> + <span class="editable" contenteditable>${randomErr(BC2)}</span><br>
  AC² = <span class="editable" contenteditable>${randomErr(sum)}</span><br>
  AC = √<span class="editable" contenteditable>${randomErr(sum)}</span><br>
  AC = <span class="editable" contenteditable>${randomErr(AC)}</span> m<br>
  <br>
  La longueur AC est de <span class="editable" contenteditable>${randomErr(AC)}</span> m.
  `;

  textArea.innerHTML = texte;
  sideAB.textContent = `AB = ${AB} m`;
  sideBC.textContent = `BC = ${BC} m`;
  sideAC.textContent = `AC = ?`;
  feedback.textContent = '';
}

function checkAnswers() {
  const edits = Array.from(document.querySelectorAll('.editable'));
  let correct = 0;
  let total = edits.length;

  edits.forEach(span => {
    const val = span.textContent.trim().replace(",", ".");
    let ok = false;

    if (val === correctValues.angle || val.toUpperCase() === correctValues.angle) ok = true;
    if (val.replace(/\s+/g, "") === correctValues.formula.replace(/\s+/g, "")) ok = true;

    const numVal = parseFloat(val);
    if (!isNaN(numVal)) {
      const close = Object.values(correctValues).some(v => Math.abs(parseFloat(v) - numVal) < 0.15);
      if (close) ok = true;
    }

    span.style.color = ok ? "green" : "red";
    if (ok) correct++;
  });

  feedback.textContent = correct === total ? "✅ Parfait !" : "❌ Il y a des erreurs à corriger.";
}

generateExercise();
</script>
</body>
</html>
