<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Figures composées</title>
<style>
body { font-family: sans-serif; text-align:center; background:#f0f4f8; margin:2rem; }
canvas { background:white; border:1px solid #ccc; border-radius:8px; margin-bottom:1rem; }
.controls { display:flex; flex-wrap:wrap; justify-content:center; gap:0.5rem; margin-bottom:1rem; }
.btn { padding:0.5rem 1rem; border-radius:6px; border:none; background:#3a86ff; color:white; cursor:pointer; font-size:1rem; }
.btn:hover { background:#8338ec; }
.feedback { font-weight:bold; height:1.5rem; }
.feedback.ok { color:green; }
.feedback.bad { color:red; }
</style>
</head>
<body>

<h1>Devine les formes de la figure</h1>
<canvas id="canvas" width="400" height="400"></canvas>

<div class="controls">
  <button class="btn" data-shape="square">aire carré</button>
  <button class="btn" data-shape="triangle">aire triangle</button>
  <button class="btn" data-shape="rectangle">aire rectangle</button>
  <button class="btn" data-shape="circle">aire cercle</button>
  <button class="btn" data-shape="plus">+</button>
  <button class="btn" data-shape="minus">-</button>
  <button class="btn" id="checkBtn">Valider</button>
</div>

<div class="feedback" id="feedback"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const feedbackEl = document.getElementById('feedback');
const checkBtn = document.getElementById('checkBtn');

const shapesTypes = ['square','rectangle','triangle','circle'];
let figure = [];
let studentAnswer = [];

// Utilitaire
function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

// Générer figure aléatoire avec formes collées/extrudées
function generateFigure(){
  figure = [];
  const numShapes = randomInt(3,6);
  let baseX = randomInt(50, 250);
  let baseY = randomInt(50, 250);

  for(let i=0;i<numShapes;i++){
    const type = shapesTypes[randomInt(0,shapesTypes.length-1)];
    const w = randomInt(30,80);
    const h = randomInt(30,80);
    // Position proche de la figure précédente pour “coller” ou extruder
    const x = baseX + randomInt(-20,20);
    const y = baseY + randomInt(-20,20);
    figure.push({type,x,y,w,h});
    // Mise à jour base pour forme suivante
    baseX = x; baseY = y;
  }
}

// Dessiner la figure
function drawFigure(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  figure.forEach(s=>{
    ctx.fillStyle='rgba(58,134,255,0.7)';
    ctx.strokeStyle='black';
    ctx.lineWidth=1;
    switch(s.type){
      case 'square': ctx.fillRect(s.x,s.y,s.w,s.w); ctx.strokeRect(s.x,s.y,s.w,s.w); break;
      case 'rectangle': ctx.fillRect(s.x,s.y,s.w,s.h); ctx.strokeRect(s.x,s.y,s.w,s.h); break;
      case 'triangle':
        ctx.beginPath();
        ctx.moveTo(s.x,s.y+s.h);
        ctx.lineTo(s.x+s.w/2,s.y);
        ctx.lineTo(s.x+s.w,s.y+s.h);
        ctx.closePath();
        ctx.fill(); ctx.stroke();
        break;
      case 'circle':
        ctx.beginPath();
        ctx.arc(s.x+s.w/2,s.y+s.w/2,s.w/2,0,Math.PI*2);
        ctx.fill(); ctx.stroke();
        break;
    }
  });
}

// Réponse correcte
function correctAnswer(){
  return figure.map(s=>s.type);
}

// Nouvelle question
function newQuestion(){
  generateFigure();
  drawFigure();
  studentAnswer = [];
  feedbackEl.textContent='';
  feedbackEl.className='feedback';
}

// Gestion clic boutons
document.querySelectorAll('.btn[data-shape]').forEach(btn=>{
  btn.addEventListener('click',e=>{
    const type = e.target.dataset.shape;
    studentAnswer.push(type);
    feedbackEl.textContent = 'Réponse en cours : '+studentAnswer.join(' ');
  });
});

// Validation
checkBtn.addEventListener('click',()=>{
  const correct = correctAnswer();
  const answerFiltered = studentAnswer.filter(a=>shapesTypes.includes(a));
  const ok = correct.length === answerFiltered.length &&
             correct.every(v=>answerFiltered.includes(v));
  feedbackEl.textContent = ok?'Bravo ! ✅':'Essaye encore ❌';
  feedbackEl.className = ok?'feedback ok':'feedback bad';
  setTimeout(newQuestion, 1500);
});

// Première question
newQuestion();
</script>

</body>
</html>
