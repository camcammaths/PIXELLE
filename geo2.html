<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calcul du Perimetre</title>
<style>
:root{
  --primary-color:#3a86ff;
  --background-color:#f8fafc;
  --cell-size:40px;
  --line-color:#3a86ff;
  --text-color:#222;
  --border-radius:8px;
}
body{
  font-family:'Mabry Pro',sans-serif;
  background:var(--background-color);
  margin:0;
  padding:2rem;
  text-align:center;
  color:var(--text-color);
}
h1{
  color:var(--primary-color);
  font-size:2rem;
  margin-bottom:1rem;
}
#gridWrap{
  display:flex;
  justify-content:center;
  align-items:center;
  padding:1rem;
}
#grid{
  display:grid;
  gap:0;
  position:relative;
}
.cell{
  width:var(--cell-size);
  height:var(--cell-size);
  border:1px solid transparent;
  box-sizing:border-box;
  position:relative;
  background:transparent; /* int√©rieur vide */
}
.edge{
  position:absolute;
  background:var(--line-color);
}
.edge.top, .edge.bottom{
  height:3px;
  width:100%;
  left:0;
}
.edge.left, .edge.right{
  width:3px;
  height:100%;
  top:0;
}
.edge.top{top:0;}
.edge.bottom{bottom:0;}
.edge.left{left:0;}
.edge.right{right:0;}

.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:0.5rem;
  margin:1.2rem 0;
}
input{
  padding:0.5rem 0.7rem;
  border:2px solid rgba(0,0,0,0.1);
  border-radius:var(--border-radius);
  width:120px;
  font-size:1rem;
}
button{
  background:var(--primary-color);
  border:none;
  color:white;
  padding:0.6rem 1rem;
  border-radius:var(--border-radius);
  cursor:pointer;
  transition:0.2s;
}
button:hover{background:#8338ec;}
.feedback{
  height:1.5rem;
  font-weight:bold;
}
.feedback.ok{color:green;}
.feedback.bad{color:red;}
</style>
</head>
<body>

<h1>üß© Calcul du Perimetre</h1>

<div id="gridWrap"><div id="grid"></div></div>

<div class="controls">
  <input id="answer" type="number" min="0" placeholder="Ton p√©rim√®tre" />
  <button id="checkBtn">Valider</button>
</div>

<div class="feedback" id="feedback"></div>

<script>
const gridEl = document.getElementById('grid');
const answerEl = document.getElementById('answer');
const feedbackEl = document.getElementById('feedback');
const checkBtn = document.getElementById('checkBtn');

let coords = new Set();
let correctPerimeter = 0;

function coordKey(x,y){return `${x},${y}`;}
function parseKey(k){const [x,y]=k.split(',').map(Number);return {x,y};}

function generateShape(minCells=4,maxCells=10){
  coords.clear();
  const target = Math.floor(Math.random()*(maxCells-minCells+1))+minCells;
  coords.add(coordKey(0,0));
  const frontier = [coordKey(0,0)];

  while(coords.size < target && frontier.length>0){
    const base = frontier[Math.floor(Math.random()*frontier.length)];
    const {x,y} = parseKey(base);
    const candidates = [[x+1,y],[x-1,y],[x,y+1],[x,y-1]]
      .map(([nx,ny]) => coordKey(nx,ny))
      .filter(n => !coords.has(n));
    if(candidates.length){
      const pick = candidates[Math.floor(Math.random()*candidates.length)];
      coords.add(pick);
      frontier.push(pick);
    } else frontier.splice(frontier.indexOf(base),1);
  }
  correctPerimeter = computePerimeter();
  drawGrid();
}

function computePerimeter(){
  let perim = 0;
  for(const key of coords){
    const {x,y} = parseKey(key);
    const sides = [
      [x,y-1],[x,y+1],[x-1,y],[x+1,y]
    ];
    for(const [nx,ny] of sides){
      if(!coords.has(coordKey(nx,ny))) perim++;
    }
  }
  return perim;
}

function drawGrid(){
  const pts = Array.from(coords).map(parseKey);
  const xs = pts.map(p=>p.x);
  const ys = pts.map(p=>p.y);
  const minX = Math.min(...xs), maxX = Math.max(...xs);
  const minY = Math.min(...ys), maxY = Math.max(...ys);
  const width = maxX-minX+1, height = maxY-minY+1;

  gridEl.style.gridTemplateColumns = `repeat(${width}, var(--cell-size))`;
  gridEl.style.gridTemplateRows = `repeat(${height}, var(--cell-size))`;
  gridEl.innerHTML='';

  for(let y=minY;y<=maxY;y++){
    for(let x=minX;x<=maxX;x++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      if(coords.has(coordKey(x,y))){
        // Ajouter seulement les bords visibles
        const dirs = {
          top: !coords.has(coordKey(x,y-1)),
          bottom: !coords.has(coordKey(x,y+1)),
          left: !coords.has(coordKey(x-1,y)),
          right: !coords.has(coordKey(x+1,y))
        };
        for(const d in dirs){
          if(dirs[d]){
            const edge = document.createElement('div');
            edge.classList.add('edge', d);
            cell.appendChild(edge);
          }
        }
      }
      gridEl.appendChild(cell);
    }
  }
}

checkBtn.addEventListener('click', ()=>{
  const val = parseInt(answerEl.value);
  if(isNaN(val)) return;
  if(val === correctPerimeter){
    feedbackEl.textContent = '‚úÖ Correct !';
    feedbackEl.className = 'feedback ok';
  } else {
    feedbackEl.textContent = `‚ùå Faux (p√©rim√®tre = ${correctPerimeter})`;
    feedbackEl.className = 'feedback bad';
  }
  setTimeout(()=>{
    answerEl.value='';
    generateShape();
  },1000);
});

// G√©n√©rer la premi√®re forme
generateShape();
</script>
</body>
</html>
