<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exercice Aire — Figures composées</title>
<link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />
<style>
:root{
  --primary-color: #3a86ff;
  --background-color: #f0f4f8;
  --accent-square: #3a86ff;
  --cell-size: 36px;
  --border-radius: 8px;
  --transition: 0.25s ease;
  --text-color: #212529;
}
*{box-sizing:border-box}
body{
  font-family: 'Mabry Pro', sans-serif;
  background: var(--background-color);
  margin:0;
  padding:2rem;
  color:var(--text-color);
  text-align:center;
}
h1{
  font-family:'Androgy Demo',sans-serif;
  font-size:2.4rem;
  color:var(--primary-color);
  margin:0 0 1rem;
}
#canvasWrap{
  display:flex;
  justify-content:center;
  align-items:center;
  padding:1rem;
}
canvas{
  background:white;
  border:1px solid #ccc;
  border-radius:8px;
}
.controls{
  display:flex;
  gap:0.75rem;
  justify-content:center;
  align-items:center;
  margin:1rem 0;
}
button.btn{
  padding:0.6rem 1.1rem;
  border-radius:var(--border-radius);
  border:none;
  background:var(--primary-color);
  color:white;
  cursor:pointer;
  transition:background var(--transition);
  font-family:inherit;
}
button.btn:hover{background:#8338ec}
.feedback{
  height:1.4rem;
  margin-top:0.5rem;
  font-weight:700;
}
.feedback.ok{color:green}
.feedback.bad{color:red}
</style>
</head>
<body>

<h1>Devine les formes de la figure</h1>

<div id="canvasWrap">
  <canvas id="canvas" width="400" height="400"></canvas>
</div>

<div class="controls">
  <button class="btn" data-shape="square">Aire carré +</button>
  <button class="btn" data-shape="rectangle">Aire rectangle +</button>
  <button class="btn" data-shape="triangle">Aire triangle +</button>
  <button class="btn" data-shape="circle">Aire cercle +</button>
  <button class="btn" id="checkBtn">Valider</button>
</div>

<div class="feedback" id="feedback" aria-live="polite"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const feedbackEl = document.getElementById('feedback');
const checkBtn = document.getElementById('checkBtn');

const shapes = ['square','rectangle','triangle','circle'];
let figure = [];
let studentAnswer = {};

function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}

// Générer une figure composée de formes élémentaires collées
function generateFigure(){
  figure = [];
  const baseX = 50 + randomInt(0,200);
  const baseY = 50 + randomInt(0,200);
  const numShapes = randomInt(3,6);

  for(let i=0;i<numShapes;i++){
    const type = shapes[randomInt(0,shapes.length-1)];
    const w = randomInt(30,80);
    const h = randomInt(30,80);
    const x = baseX + randomInt(-20,20);
    const y = baseY + randomInt(-20,20);
    figure.push({type,x,y,w,h});
  }
}

// Dessiner la figure
function drawFigure(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  figure.forEach(s=>{
    ctx.fillStyle='rgba(58,134,255,0.7)';
    ctx.strokeStyle='black';
    ctx.lineWidth=1;
    switch(s.type){
      case 'square':
        ctx.fillRect(s.x,s.y,s.w,s.w);
        ctx.strokeRect(s.x,s.y,s.w,s.w);
        break;
      case 'rectangle':
        ctx.fillRect(s.x,s.y,s.w,s.h);
        ctx.strokeRect(s.x,s.y,s.w,s.h);
        break;
      case 'triangle':
        ctx.beginPath();
        ctx.moveTo(s.x,s.y+s.h);
        ctx.lineTo(s.x+s.w/2,s.y);
        ctx.lineTo(s.x+s.w,s.y+s.h);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        break;
      case 'circle':
        ctx.beginPath();
        ctx.arc(s.x+s.w/2,s.y+s.w/2,s.w/2,0,Math.PI*2);
        ctx.fill();
        ctx.stroke();
        break;
    }
  });
}

// Calculer l'aire totale par type
function calculateAnswer(){
  let answer = {square:0,rectangle:0,triangle:0,circle:0};
  figure.forEach(s=>{
    switch(s.type){
      case 'square': answer.square += s.w*s.w; break;
      case 'rectangle': answer.rectangle += s.w*s.h; break;
      case 'triangle': answer.triangle += (s.w*s.h)/2; break;
      case 'circle': answer.circle += Math.PI*(s.w/2)**2; break;
    }
  });
  return answer;
}

// Initialisation
generateFigure();
drawFigure();
const correctAnswer = calculateAnswer();

// Gestion des clics sur boutons
document.querySelectorAll('.btn[data-shape]').forEach(btn=>{
  btn.addEventListener('click',e=>{
    const type = e.target.dataset.shape;
    studentAnswer[type] = (studentAnswer[type]||0)+1;
    feedbackEl.textContent = `Tu as ajouté ${studentAnswer[type]} ${type}(s)`;
  });
});

// Validation
checkBtn.addEventListener('click',()=>{
  let ok=true;
  shapes.forEach(s=>{
    if((studentAnswer[s]||0)!==figure.filter(f=>f.type===s).length) ok=false;
  });
  feedbackEl.textContent = ok?'Bravo ! ✅':'Essaye encore ❌';
});

</script>
</body>
</html>
