<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Figures collées et extrudées</title>
<style>
body { font-family:sans-serif; text-align:center; background:#f0f4f8; margin:2rem; }
canvas { background:white; border:1px solid #ccc; border-radius:8px; margin-bottom:1rem; }
.controls { display:flex; flex-wrap:wrap; justify-content:center; gap:0.5rem; margin-bottom:1rem; }
.btn { padding:0.5rem 1rem; border-radius:6px; border:none; background:#3a86ff; color:white; cursor:pointer; font-size:1rem; }
.btn:hover { background:#8338ec; }
.feedback { font-weight:bold; height:1.5rem; }
.feedback.ok { color:green; }
.feedback.bad { color:red; }
</style>
</head>
<body>

<h1>Figures collées ou extrudées</h1>
<canvas id="canvas" width="400" height="400"></canvas>

<div class="controls">
  <button class="btn" data-shape="square">aire carré</button>
  <button class="btn" data-shape="triangle">aire triangle</button>
  <button class="btn" data-shape="rectangle">aire rectangle</button>
  <button class="btn" data-shape="circle">aire cercle</button>
  <button class="btn" data-op="plus">+</button>
  <button class="btn" data-op="minus">-</button>
  <button class="btn" id="checkBtn">Valider</button>
</div>

<div class="feedback" id="feedback"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const feedbackEl = document.getElementById('feedback');
const checkBtn = document.getElementById('checkBtn');

const shapesTypes = ['square','rectangle','triangle','circle'];
let figure = [];
let studentExpr = [];

// Utilitaire
function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

// Générer figure
function generateFigure(){
  figure = [];
  const mode = Math.random()<0.5?'coller':'extruder';
  if(mode==='coller'){
    const numShapes = randomInt(2,3);
    let baseX = randomInt(50,200);
    let baseY = randomInt(50,200);
    for(let i=0;i<numShapes;i++){
      const type = shapesTypes[randomInt(0,shapesTypes.length-1)];
      const w = randomInt(30,70);
      const h = randomInt(30,70);
      const x = baseX + randomInt(-10,10);
      const y = baseY + randomInt(-10,10);
      figure.push({type,x,y,w,h});
      baseX = x; baseY = y;
    }
  } else { // extrusion
    let baseX = randomInt(100,250);
    let baseY = randomInt(100,250);
    for(let i=0;i<2;i++){
      const type = shapesTypes[randomInt(0,shapesTypes.length-1)];
      const w = randomInt(40,80);
      const h = randomInt(40,80);
      const x = baseX;
      const y = baseY - i*10; // légèrement superposé verticalement
      figure.push({type,x,y,w,h});
    }
  }
}

// Dessiner figure
function drawFigure(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  figure.forEach(s=>{
    ctx.fillStyle='rgba(58,134,255,0.7)';
    ctx.strokeStyle='black';
    ctx.lineWidth=1;
    switch(s.type){
      case 'square': ctx.fillRect(s.x,s.y,s.w,s.w); ctx.strokeRect(s.x,s.y,s.w,s.w); break;
      case 'rectangle': ctx.fillRect(s.x,s.y,s.w,s.h); ctx.strokeRect(s.x,s.y,s.w,s.h); break;
      case 'triangle':
        ctx.beginPath();
        ctx.moveTo(s.x,s.y+s.h);
        ctx.lineTo(s.x+s.w/2,s.y);
        ctx.lineTo(s.x+s.w,s.y+s.h);
        ctx.closePath();
        ctx.fill(); ctx.stroke();
        break;
      case 'circle':
        ctx.beginPath();
        ctx.arc(s.x+s.w/2,s.y+s.w/2,s.w/2,0,Math.PI*2);
        ctx.fill(); ctx.stroke();
        break;
    }
  });
}

// Calcul aire d’une forme
function areaShape(s){
  switch(s.type){
    case 'square': return s.w*s.w;
    case 'rectangle': return s.w*s.h;
    case 'triangle': return (s.w*s.h)/2;
    case 'circle': return Math.PI*(s.w/2)**2;
  }
}

// Aire totale
function totalArea(){ return figure.reduce((acc,s)=>acc+areaShape(s),0); }

// Nouvelle question
function newQuestion(){
  generateFigure();
  drawFigure();
  studentExpr=[];
  feedbackEl.textContent='';
  feedbackEl.className='feedback';
}

// Gestion clic boutons
document.querySelectorAll('.btn[data-shape]').forEach(btn=>{
  btn.addEventListener('click',e=>{
    const type = e.target.dataset.shape;
    const s = figure.find(f=>f.type===type);
    if(s) studentExpr.push(areaShape(s));
    feedbackEl.textContent = 'Expression : '+studentExpr.join(' ');
  });
});

document.querySelectorAll('.btn[data-op]').forEach(btn=>{
  btn.addEventListener('click',e=>{
    const op = e.target.dataset.op==='plus'?'+':'-';
    studentExpr.push(op);
    feedbackEl.textContent = 'Expression : '+studentExpr.join(' ');
  });
});

// Valider
checkBtn.addEventListener('click',()=>{
  try{
    const expr = studentExpr.join(' ');
    const studentTotal = eval(expr);
    const realTotal = totalArea();
    const diff = Math.abs(studentTotal-realTotal);
    const ok = diff<0.1; // tolérance pour π
    feedbackEl.textContent = ok?'Bravo ! ✅':'Essaye encore ❌ (Aire réelle: '+realTotal.toFixed(1)+')';
    feedbackEl.className = ok?'feedback ok':'feedback bad';
  }catch(e){
    feedbackEl.textContent='Erreur dans l’expression';
    feedbackEl.className='feedback bad';
  }
  setTimeout(newQuestion,1500);
});

// Première question
newQuestion();
</script>

</body>
</html>

