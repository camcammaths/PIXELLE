<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aire — Puzzle des carrés unité</title>

  <link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />

  <style>
    :root{
      --primary-color: #3a86ff;
      --background-color: #f0f4f8;
      --accent-square: #3a86ff;
      --cell-size: 36px;
      --border-radius: 8px;
      --transition: 0.25s ease;
      --text-color: #212529;
    }

    *{box-sizing:border-box}
    body{
      font-family: 'Mabry Pro', sans-serif;
      background: var(--background-color);
      margin:0;padding:2rem;color:var(--text-color);text-align:center;
    }

    h1{
      font-family:'Androgy Demo',sans-serif;font-size:2.4rem;color:var(--primary-color);margin:0 0 1rem;
    }

    #gridWrap{display:flex;justify-content:center;align-items:center;padding:1rem}
    #grid{display:grid;gap:0px;padding:0}
    .cell{width:var(--cell-size);height:var(--cell-size);border-radius:0}
    .cell.filled{background:var(--accent-square)}

    .controls{display:flex;gap:0.75rem;justify-content:center;align-items:center;margin:1rem 0}
    input[type=number]{padding:0.5rem 0.6rem;border-radius:8px;border:2px solid rgba(0,0,0,0.08);width:120px;font-size:1rem}
    .btn{padding:0.6rem 1.1rem;border-radius:var(--border-radius);border:none;background:var(--primary-color);color:white;cursor:pointer;transition:background var(--transition);font-family:inherit}
    .btn:hover{background:#8338ec}

    .feedback{height:1.4rem;margin-top:0.5rem;font-weight:700}
    .feedback.ok{color:green}
    .feedback.bad{color:red}
  </style>
</head>
<body>

  <h1>Aire — Puzzle des carrés unité</h1>

  <div id="gridWrap">
    <div id="grid"></div>
  </div>

  <div class="controls">
    <input id="answer" type="number" min="0" inputmode="numeric" placeholder="Ton aire" />
    <button class="btn" id="checkBtn">Valider</button>
  </div>

  <div class="feedback" id="feedback" aria-live="polite"></div>

  <script>
    const gridEl = document.getElementById('grid');
    const checkBtn = document.getElementById('checkBtn');
    const answerEl = document.getElementById('answer');
    const feedbackEl = document.getElementById('feedback');

    let coords = new Set();
    let cellsCount = 0;

    function coordKey(x,y){return x+','+y}
    function parseKey(k){const [x,y]=k.split(',').map(Number);return {x,y}}

    function generateShape(minCells=5,maxCells=12){
      coords.clear();
      const target = Math.floor(Math.random()*(maxCells-minCells+1))+minCells;
      coords.add(coordKey(0,0));
      const frontier = [coordKey(0,0)];

      while(coords.size < target){
        const base = frontier[Math.floor(Math.random()*frontier.length)];
        const {x,y} = parseKey(base);
        const neigh = [ [x+1,y],[x-1,y],[x,y+1],[x,y-1] ];
        for(let i=neigh.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[neigh[i],neigh[j]]=[neigh[j],neigh[i]]}
        let added = false;
        for(const [nx,ny] of neigh){
          const k = coordKey(nx,ny);
          if(!coords.has(k)){
            coords.add(k);
            frontier.push(k);
            added = true;
            break;
          }
        }
        if(!added){
          const idx = frontier.indexOf(base);
          if(idx>-1) frontier.splice(idx,1);
          if(frontier.length===0){ coords.clear(); coords.add(coordKey(0,0)); frontier.push(coordKey(0,0)); }
        }
      }
      renderGrid();
    }

    function renderGrid(){
      const all = Array.from(coords).map(parseKey);
      const xs = all.map(o=>o.x); const ys = all.map(o=>o.y);
      const minX=Math.min(...xs), maxX=Math.max(...xs);
      const minY=Math.min(...ys), maxY=Math.max(...ys);
      const width = maxX - minX + 1;
      const height = maxY - minY + 1;
      gridEl.style.gridTemplateColumns = `repeat(${width}, var(--cell-size))`;
      gridEl.style.gridTemplateRows = `repeat(${height}, var(--cell-size))`;
      gridEl.innerHTML = '';
      const positions = new Set(coords);
      for(let y=minY;y<=maxY;y++){
        for(let x=minX;x<=maxX;x++){
          const k = coordKey(x,y);
          const div = document.createElement('div');
          div.className = 'cell';
          if(positions.has(k)) div.classList.add('filled');
          gridEl.appendChild(div);
        }
      }
      cellsCount = coords.size;
      feedbackEl.textContent = '';
      feedbackEl.className = 'feedback';
      answerEl.value = '';
      answerEl.focus();
    }

    function checkAnswer(){
      const val = Number(answerEl.value);
      if(!Number.isFinite(val) || val<0){
        feedbackEl.textContent = 'Entrez un nombre valide.'; feedbackEl.className='feedback bad'; return;
      }
      if(Math.round(val)===cellsCount){
        feedbackEl.textContent='Correct !'; feedbackEl.className='feedback ok';
      } else {
        feedbackEl.textContent='Incorrect'; feedbackEl.className='feedback bad';
      }
      setTimeout(()=>generateShape(),1000);
    }

    checkBtn.addEventListener('click',checkAnswer);
    answerEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkAnswer(); });

    generateShape();
  </script>
</body>
</html>
